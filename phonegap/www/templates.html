<!-- ko if: !auth.currentUser() -->
<div id="auth">
	<div>
		<h1>allocate</h1>
		<div class="alert alert-danger alert-dismissable" data-bind="fadeVisible: auth.errorMessage().length > 0, text: auth.errorMessage"></div>
		<form data-bind="submit: auth.signInUp">
			<input name="auth_email" type="text" class="form-control" placeholder="Email" data-bind="fadeVisible: auth.signUpMode">
			<input name="auth_displayName" type="text" class="form-control" placeholder="First and last name" data-bind="fadeVisible: auth.signUpMode">
			<input name="auth_username" type="text" class="form-control" placeholder="Username" autocapitalize="off">
			<input name="auth_password" type="password" class="form-control" placeholder="Password">
			<input name="auth_confirmPassword" type="password" class="form-control" placeholder="Confirm password" data-bind="fadeVisible: auth.signUpMode">
			<button type="submit" class="btn btn-default navbar-btn" data-bind="text: (auth.signUpMode() ? 'Sign up' : 'Sign in')">Sign in</button> or <a data-bind="event: { touchend: auth.showSignUp }, text: (auth.signUpMode() ? 'sign in' : 'sign up')">Sign up</a>
		</form>
	</div>
</div>
<!-- /ko -->
<!-- ko if: auth.currentUser -->
<div id="header" class="navbar navbar-default" role="navigation">
	<div class="container-fluid">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle fa fa-bars" data-toggle="collapse" data-target=".navbar-collapse"></button>
			<span class="logo" data-bind="event: { touchend: auth.scrollTop }"><img src="svg/logo.svg" /></span>
		</div>
		<div class="navbar-collapse collapse">
			<ul class="nav navbar-nav navbar-right" data-bind="foreach: header.pages">
				<li data-bind="css: { active: $parent.header.activePage() == $index() }, tap: function() { $parent.header.goToPage($index()) }"><a href="#" data-bind="text: display"></a></li>
				<!-- ko if: ($index() + 1) == $parent.header.pages().length -->
				<li><button class="btn btn-default navbar-btn" data-bind="tap: $parent.header.logout">Log out</button></li>
				<!-- /ko -->
			</ul>
		</div><!--/.nav-collapse -->
	</div><!--/.container-fluid -->
</div>
<!-- /ko -->
<!-- ko if: auth.currentUser() && header.activePage() == 0 -->
<div id="notes" class="screen" data-bind="fadeVisible: steps.currentStep() == 3">
	<h1>Any notes about the projects?</h1>
	<div id="notes-accordion" class="panel-group container" data-bind="foreach: selectProject.allProjects">
		<!-- ko if: $data.attributes.active() -->
		<div class="panel panel-default">
			<div class="panel-heading">
				<h4 class="panel-title">
					<a data-toggle="collapse" data-parent="#notes-accordion" data-bind="attr: { href: '#notes-collapse-' + $index() }, text: name"></a>
				</h4>
			</div>
			<div class="panel-collapse collapse" data-bind="attr: { id: 'notes-collapse-' + $index() }">
				<div class="panel-body" onClick="this.contentEditable='true';">
				</div>
			</div>
		</div>
		<!-- /ko -->
	</div>
</div>
<!-- /ko -->
<!-- ko if: auth.currentUser() && header.activePage() == 1 -->
<div id="people" class="screen" data-bind="fadeVisible: !people.showDetails()">
	<div class="page-header">
		<h1>Week starting</h1>
		<div class="group-type btn-group btn-group-xs" data-bind="tap: people.toggleView">
			<button type="button" class="btn btn-default" data-bind="css: { active: people.viewType() == 'hours' }">h</button>
			<button type="button" class="btn btn-default" data-bind="css: { active: people.viewType() == 'percent' }">%</button>
		</div>
		<div class="group-weeks btn-group" data-bind="foreach: people.weeks">
			<button type="button" class="btn btn-default" data-bind="tap: function() { $parent.people.selectWeek($index()) }, css: { active: $parent.people.activeWeek() == $index() }">
				<span data-bind="text: date"></span>
			</button>
		</div>
	</div>
	<ol data-bind="foreach: people.all" class="people">
		<li class="person" data-bind="tap: $parent.people.goToPerson">
			<div class="bar">
				<span class="percent" data-bind="text: _.reduce($data.percentages(), function(memo, num){ return memo + num; }, 0) * ($parent.people.viewType() == 'hours' ? 0.4 : 1) + ($parent.people.viewType() == 'hours' ? 'h' : '%')"></span>
				<span class="name" data-bind="text: name"></span>
			</div>
			<div class="percentage-container" data-bind="foreach: percentages">
				<div class="percentage" data-bind="style: { width: $data + '%' }"></div>
			</div>
		</li>
	</ol>
</div>
<!-- /ko -->
<!-- ko if: auth.currentUser() && (header.activePage() == 0 || header.activePage() == 1) -->
<div id="rate-week" class="screen" data-bind="fadeVisible: steps.currentStep() == 1 || (header.activePage() == 1 && people.showDetails())">
	<div class="page-header">
		<!-- ko if: people.showDetails -->
		<button class="back-button fa fa-chevron-circle-left" data-bind="tap: rateWeek.goBack"></button>
		<!-- /ko -->
		<h1 data-bind="text: people.showDetails() ? people.activePerson().name : 'Week starting'"></h1>
		<div class="group-type btn-group btn-group-xs" data-bind="tap: rateWeek.toggleView">
			<button type="button" class="btn btn-default" data-bind="css: { active: rateWeek.viewType() == 'hours' }">h</button>
			<button type="button" class="btn btn-default" data-bind="css: { active: rateWeek.viewType() == 'percent' }">%</button>
		</div>
		<div class="group-weeks btn-group" data-bind="foreach: rateWeek.weeks">
			<button type="button" class="btn btn-default" data-bind="tap: function() { $parent.rateWeek.selectWeek($index()) }, css: { active: $parent.rateWeek.activeWeek() == $index() }">
				<span data-bind="text: date"></span>
				<div class="total" data-bind="text: total() * ($parent.rateWeek.viewType() == 'hours' ? 0.4 : 1) + ($parent.rateWeek.viewType() == 'hours' ? 'h' : '%'), css: { over: $data.total() > 100 }"></div>
			</button>
		</div>
	</div>
	<ol data-bind="foreach: selectProject.allProjects" class="projects">
		<!-- ko if: $data.attributes.active() -->
		<li class="project" data-bind="css: { 'internal': $data.attributes.company == 'Internal', zero: $data.attributes.percentage()[$parent.rateWeek.activeWeek()].value() == 0 }, drag: $parent.rateWeek.drag">
			<div class="name">
				<span class="percent" data-bind="text: $data.attributes.percentage()[$parent.rateWeek.activeWeek()].value() * ($parent.rateWeek.viewType() == 'hours' ? 0.4 : 1) + ($parent.rateWeek.viewType() == 'hours' ? 'h' : '%')"></span>
				<span class="project" data-bind="text: attributes.name"></span>
			</div>
			<div class="percentage-container">
				<div class="percentage" data-bind="style: { width: $data.attributes.percentage()[$parent.rateWeek.activeWeek()].value() + '%' }"></div>
			</div>
		</li>
		<!-- /ko -->
	</ol>
</div>
<!-- /ko -->
<!-- ko if: auth.currentUser() && header.activePage() == 0 -->
<div id="select-project" class="screen" data-bind="fadeVisible: steps.currentStep() == 0">
	<div class="page-header">
		<h1>Select projects</h1>
		<div class="group-type btn-group btn-group-xs">
			<button class="add btn btn-default" data-bind="visible: auth.isAdmin, tap: selectProject.toggleAddMode"><span class="fa fa-plus"> Add</span></button>
		</div>
		<div class="group-type btn-group btn-group-xs" data-bind="tap: selectProject.toggleView">
			<button type="button" class="btn btn-default" data-bind="css: { active: selectProject.viewType() == 'all' }">all</button>
			<button type="button" class="btn btn-default" data-bind="css: { active: selectProject.viewType() == 'selected' }"><span class="fa fa-check"></span></button>
		</div>
	</div>
	<div class="row">
		<div class="col-xs-12">
			<ul data-bind="foreach: selectProject.allProjects" class="all-projects">
				<!-- ko if: ($data.attributes.active() || $parent.selectProject.viewType() == 'all') && !$data.attributes.archived -->
				<li data-bind="css: { active: $data.attributes.active(), 'internal': $data.attributes.company == 'Internal' }, tap: $parent.selectProject.toggleProject">
					<span class="name" data-bind="text: (attributes.company == 'Internal' ? 'Internal' : attributes.company) + ':'"></span>
					<span class="name" data-bind="text: attributes.name"></span>
					<span class="check fa fa-check" data-bind="visible: attributes.active"></span>
				</li>
				<!-- /ko -->
			</ul>
		</div>
	</div>
</div>
<div class="modal add-project" data-bind="fadeVisible: selectProject.isAddMode">
	<div class="container">
		<div class="title">
			<h2>Add Project</h2>
			<button data-bind="tap: selectProject.toggleAddMode"><span class="fa fa-times"></span></button>
		</div>
		<div class="content">
			<div class="typeahead">
				<div class="input-group input-group-lg">
					<!-- <span class="input-group-addon">Company</span> -->
					<input class="project-typeahead-field form-control" type="text" data-bind="event: { keyup: selectProject.showTypeaheadResults }" autocapitalize="on" autocorrect="off" placeholder="Company">
				</div>
				<ul class="project-typeahead" data-bind="foreach: selectProject.filteredProjectList, visible: selectProject.filteredProjectList().length > 0">
					<li data-bind="text: $data, tap: $parent.selectProject.selectProjectTypeahead"></li>
				</ul>
			</div>
			<div class="input-group input-group-lg">
				<!-- <span class="input-group-addon">Project</span> -->
				<input class="project-name-field form-control" type="text" autocapitalize="on" autocorrect="on" placeholder="Project">
			</div>
		</div>
		<div class="footer">
			<button class="btn btn-default" data-bind="tap: selectProject.saveNewProject">Save</button>
			<span data-bind="tap: selectProject.toggleAddMode">Cancel</span>
		</div>
	</div>
</div>
<!-- /ko -->
<!-- ko if: auth.currentUser() && header.activePage() == 0 -->
<div id="steps">
	<button data-bind="fadeVisible: steps.currentStep() > 0, tap: function() { steps.nextStep(-1) }" class="fa fa-chevron-left left"></button>
	<ul data-bind="foreach: steps.steps">
		<li data-bind="css: { active: $data.stepNumber == $parent.steps.currentStep() }"></li>
	</ul>
	<button data-bind="fadeVisible: steps.currentStep() < steps.steps().length - 1, tap: function() { steps.nextStep(1) }" class="fa fa-chevron-right right"></button>
</div>
<!-- /ko -->